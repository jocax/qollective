# Quality Control MCP Server Configuration
# All values can be overridden by environment variables with QUALITY_CONTROL_ prefix
# Example: QUALITY_CONTROL_NATS_URL=nats://production:4222

[service]
name = "quality-control"
version = "0.1.0"
description = "TaleTrail Quality Control MCP Server - Validates content for age-appropriateness and safety"

# LLM Configuration
# Base URL for LLM API endpoint (compatible with OpenAI API format)
[llm]
type = "google"
url = "https://generativelanguage.googleapis.com"
default_model = "gemini-2.0-flash-lite"
use_default_model_fallback = true
timeout_secs = 180
max_tokens = 4096
temperature = 0.7
system_prompt_style = "chatml"

# Language-specific LLM models
[llm.models]
en = "gemini-2.0-flash-lite"
de = "gemini-2.0-flash-lite"

[nats]
url = "nats://localhost:5222"
subject = "mcp.quality.validate"
queue_group = "quality-control"

[nats.auth]
# NKey authentication (replaces mTLS client certificates)
nkey_file = "../nkeys/quality-control.nk"

[nats.tls]
# TLS for encryption (no client cert needed with NKey auth)
ca_cert = "../certs/ca.pem"

[validation]
min_quality_score = 0.7
timeout_secs = 10
max_negotiation_rounds = 3
discovery_delay_ms = 100  # Delay for discovery responses

# Age-specific rubrics for content validation
[rubrics.age_6_8]
max_sentence_length = 15
vocabulary_level = "basic"
allowed_themes = ["animals", "friendship", "colors", "shapes", "family", "adventure", "nature"]

[rubrics.age_9_11]
max_sentence_length = 20
vocabulary_level = "intermediate"
allowed_themes = ["adventure", "science", "nature", "teamwork", "exploration", "mystery", "history"]

[rubrics.age_12_14]
max_sentence_length = 25
vocabulary_level = "intermediate"
allowed_themes = ["mystery", "history", "environment", "technology", "culture", "science", "teamwork"]

[rubrics.age_15_17]
max_sentence_length = 30
vocabulary_level = "advanced"
allowed_themes = ["mystery", "history", "environment", "technology", "culture", "philosophy", "ethics"]

[rubrics.age_18_plus]
max_sentence_length = 35
vocabulary_level = "advanced"
allowed_themes = ["mystery", "history", "environment", "technology", "culture", "philosophy", "ethics", "complex-science"]

# Safety validation configuration
[safety]
# Enable keyword-based safety validation
enable_keyword_validation = true

# Directory containing per-language restricted word files
restricted_words_dir = "../quality-control/safety"

# Automatically load restricted words based on request language
auto_load_by_language = true

# Educational criteria and keywords
[educational]
educational_keywords = [
    "learn", "discover", "explore", "understand", "science",
    "math", "nature", "history", "study", "investigate",
    "experiment", "observe", "research", "analyze", "question"
]

[educational.goals]
science = ["scientific method", "observation", "hypothesis", "experiment", "conclusion"]
math = ["counting", "numbers", "patterns", "problem solving", "logic"]
nature = ["animals", "plants", "ecosystems", "conservation", "biodiversity"]
social = ["friendship", "teamwork", "empathy", "cooperation", "communication"]
history = ["timeline", "culture", "civilization", "artifacts", "exploration"]
technology = ["innovation", "invention", "engineering", "coding", "design"]

# Validation thresholds for quality control
[validation.thresholds]
min_age_appropriate_score = 0.7
min_educational_value_score = 0.25
max_safety_violations = 0

# Correction capability configuration
[validation.correction]
can_fix_locally_min_score = 0.6
can_fix_locally_max_violations = 3
needs_revision_min_score = 0.3
needs_revision_max_violations = 6

[execution]
# Root directory for execution logs (relative to MCP server working directory)
root_directory = "../taletrail-data/execution"
# Enable request-ID subdirectory organization
use_request_subdirs = true
# Log level for execution logging
log_level = "info"
