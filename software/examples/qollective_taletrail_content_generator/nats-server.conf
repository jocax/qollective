# TaleTrail NATS Server - Secured with NKey Authentication
# Subject-level authorization enforces principle of least privilege

# Port Configuration
port: 5222

# Connection and Request Timeouts
# write_deadline: Maximum time for writing to a connection (default: 10s)
# Increase for slow networks or large payloads
write_deadline: "30s"

# max_pending: Maximum bytes buffered for a client (default: 10MB)
# Increase for large message payloads
max_pending: 67108864  # 64MB

# TLS Configuration for Client Connections
tls {
  cert_file: "/certs/server-cert.pem"
  key_file: "/certs/server-key.pem"
  ca_file: "/certs/ca.pem"
  verify: false          # Don't require client certificates
  verify_and_map: false  # Don't map client certificates to users
  timeout: 60        # Increased for slower remote API calls
}

# HTTPS Monitoring (TLS-enabled)
https_port: 8222

# JetStream Configuration
jetstream {
  store_dir: /data
  max_memory_store: 1GB
  max_file_store: 10GB
}

# NKey Authorization - User definitions loaded from generated file
#
# The authorization configuration is maintained in nkeys/users.conf
# This file is generated by nkeys/generate-nkeys.sh and includes:
# - Test user with password authentication
# - Service users with NKey authentication and least-privilege permissions
#
# To regenerate: cd nkeys && ./generate-nkeys.sh
authorization {
  include "nkeys/users.conf"
}

# Logging
debug: false
trace: false
logtime: true
log_file: "/data/nats-server.log"
