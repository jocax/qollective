<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holodeck Environment Test Results</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #e94560;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(233, 69, 96, 0.1);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #e94560;
        }
        
        .header h1 {
            font-size: 2.5em;
            color: #00ff41;
            text-shadow: 0 0 20px #00ff41;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            font-size: 1.2em;
            color: #0f4c75;
            font-weight: 300;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .test-card {
            background: rgba(15, 76, 117, 0.2);
            border: 2px solid #0f4c75;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            border-color: #00ff41;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }
        
        .test-card.success {
            border-color: #00ff41;
            background: rgba(0, 255, 65, 0.1);
        }
        
        .test-card.failed {
            border-color: #e94560;
            background: rgba(233, 69, 96, 0.1);
        }
        
        .test-card.pending {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .test-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #00ff41;
        }
        
        .test-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .test-status.success {
            background: #00ff41;
            color: #1a1a2e;
        }
        
        .test-status.failed {
            background: #e94560;
            color: white;
        }
        
        .test-status.pending {
            background: #ffd700;
            color: #1a1a2e;
        }
        
        .test-description {
            color: #0f4c75;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .test-details {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #00ff41;
        }
        
        .test-output {
            background: #000;
            color: #00ff41;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .environment-3d {
            background: linear-gradient(45deg, #1a1a2e, #0f4c75);
            border: 2px solid #00ff41;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }
        
        .environment-3d h2 {
            color: #00ff41;
            text-shadow: 0 0 10px #00ff41;
            margin-bottom: 20px;
        }
        
        .environment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .environment-type {
            background: rgba(233, 69, 96, 0.2);
            border: 1px solid #e94560;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .environment-type h3 {
            color: #00ff41;
            margin-bottom: 10px;
        }
        
        .environment-type p {
            color: #0f4c75;
            font-size: 0.9em;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(15, 76, 117, 0.3);
            border: 2px solid #0f4c75;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #00ff41;
            text-shadow: 0 0 10px #00ff41;
        }
        
        .stat-label {
            color: #0f4c75;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .real-time-log {
            background: #000;
            border: 2px solid #00ff41;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
        }
        
        .real-time-log h2 {
            color: #00ff41;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #00ff41;
        }
        
        .log-entry {
            color: #00ff41;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 255, 65, 0.2);
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .timestamp {
            color: #0f4c75;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #0f4c75;
        }
        
        .run-tests-btn {
            background: #00ff41;
            color: #1a1a2e;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 10px;
        }
        
        .run-tests-btn:hover {
            background: #00cc33;
            box-shadow: 0 0 20px #00ff41;
        }
        
        .run-tests-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #00ff41;
            font-size: 1.2em;
        }
        
        .loading.active {
            display: block;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåå Holodeck Environment Test Suite</h1>
            <p class="subtitle">Phase 5 - Real-time LLM-powered 3D Environment Generation Testing</p>
            <button class="run-tests-btn" onclick="runTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button class="run-tests-btn" onclick="runSingleTest('environment_generation')">üåç Test Environment Generation</button>
            <button class="run-tests-btn" onclick="clearResults()">üóëÔ∏è Clear Results</button>
        </div>

        <div class="loading" id="loading">
            <div class="pulse">üîÑ Running tests... Please wait</div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-tests">9</div>
                <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="passed-tests">0</div>
                <div class="stat-label">Passed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="failed-tests">0</div>
                <div class="stat-label">Failed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="test-time">0.0s</div>
                <div class="stat-label">Execution Time</div>
            </div>
        </div>

        <div class="test-grid" id="test-results">
            <!-- Test cards will be populated here -->
        </div>

        <div class="environment-3d">
            <h2>üåç Supported 3D Environment Types</h2>
            <div class="environment-grid">
                <div class="environment-type">
                    <h3>üöÄ Starship Interior</h3>
                    <p>Federation starships with authentic Star Trek design elements and advanced technology interfaces</p>
                </div>
                <div class="environment-type">
                    <h3>üëΩ Alien World</h3>
                    <p>Unique extraterrestrial ecosystems with distinctive atmospheric and geological features</p>
                </div>
                <div class="environment-type">
                    <h3>üèõÔ∏è Historical Setting</h3>
                    <p>Period-accurate environments with authentic architecture and cultural elements</p>
                </div>
                <div class="environment-type">
                    <h3>üßô Fantasy Realm</h3>
                    <p>Magical environments with otherworldly architecture and enchanted atmospheric conditions</p>
                </div>
                <div class="environment-type">
                    <h3>üåå Space Environment</h3>
                    <p>Zero-gravity environments with cosmic phenomena and stellar backgrounds</p>
                </div>
                <div class="environment-type">
                    <h3>üéØ Training Facility</h3>
                    <p>Controlled holodeck training environments with safety constraints and simulation parameters</p>
                </div>
            </div>
        </div>

        <div class="real-time-log">
            <h2>üì° Real-time Test Execution Log</h2>
            <div id="test-log">
                <div class="log-entry">
                    <span class="timestamp">[00:00:00]</span> Holodeck Environment Test Suite initialized
                </div>
                <div class="log-entry">
                    <span class="timestamp">[00:00:01]</span> Waiting for test execution...
                </div>
            </div>
        </div>

        <div class="footer">
            <p>‚õµCaptain Qollective üíé | Holodeck Environment Service | Phase 5 LLM Integration</p>
            <p>Generated test visualization for comprehensive environment generation validation</p>
        </div>
    </div>

    <script>
        const testDefinitions = [
            {
                name: 'WebSocket Connection',
                id: 'websocket_connection',
                description: 'Tests basic WebSocket connectivity to holodeck-environment server',
                command: 'test_qollective_websocket_connection'
            },
            {
                name: 'Health Check',
                id: 'health_check', 
                description: 'Validates server health status and operational metrics',
                command: 'test_health_check'
            },
            {
                name: 'Service Information',
                id: 'service_info',
                description: 'Retrieves and validates service metadata and capabilities',
                command: 'test_get_service_info'
            },
            {
                name: '3D Environment Generation',
                id: 'environment_generation',
                description: 'Tests LLM-powered generation of immersive 3D environments',
                command: 'test_generate_environment'
            },
            {
                name: 'Scene Management - Lighting',
                id: 'scene_lighting',
                description: 'Tests dynamic lighting updates and atmospheric modifications',
                command: 'test_manage_scene_update_lighting'
            },
            {
                name: 'Scene Management - Weather',
                id: 'scene_weather',
                description: 'Tests real-time weather changes and environmental effects',
                command: 'test_manage_scene_change_weather'
            },
            {
                name: 'Environmental Safety Validation',
                id: 'safety_validation',
                description: 'Validates safety constraint compliance and risk assessment',
                command: 'test_validate_environmental_safety'
            },
            {
                name: 'Error Handling',
                id: 'error_handling',
                description: 'Tests graceful error handling for invalid operations',
                command: 'test_invalid_tool_call' 
            },
            {
                name: 'Multiple Environment Types',
                id: 'multiple_environments',
                description: 'Tests generation across different environment categories',
                command: 'test_environment_generation_with_different_types'
            }
        ];

        let testResults = {};
        let currentTestRun = null;

        function initializeTestCards() {
            const container = document.getElementById('test-results');
            container.innerHTML = '';
            
            testDefinitions.forEach(test => {
                const card = createTestCard(test);
                container.appendChild(card);
            });
        }

        function createTestCard(test) {
            const card = document.createElement('div');
            card.className = 'test-card pending';
            card.id = `test-${test.id}`;
            
            card.innerHTML = `
                <div class="test-header">
                    <div class="test-name">${test.name}</div>
                    <div class="test-status pending">Pending</div>
                </div>
                <div class="test-description">${test.description}</div>
                <div class="test-details">
                    <strong>Command:</strong> ${test.command}<br>
                    <strong>Status:</strong> <span id="status-${test.id}">Waiting for execution</span><br>
                    <strong>Duration:</strong> <span id="duration-${test.id}">-</span><br>
                    <strong>Result:</strong> <span id="result-${test.id}">Not run</span>
                </div>
                <div class="test-output" id="output-${test.id}" style="display:none;"></div>
            `;
            
            return card;
        }

        function updateTestCard(testId, status, duration, output, result) {
            const card = document.getElementById(`test-${testId}`);
            const statusSpan = document.getElementById(`status-${testId}`);
            const durationSpan = document.getElementById(`duration-${testId}`);
            const resultSpan = document.getElementById(`result-${testId}`);
            const outputDiv = document.getElementById(`output-${testId}`);
            const statusBadge = card.querySelector('.test-status');
            
            // Update card appearance
            card.className = `test-card ${status}`;
            statusBadge.className = `test-status ${status}`;
            statusBadge.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            
            // Update details
            statusSpan.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            durationSpan.textContent = duration || '-';
            resultSpan.textContent = result || 'Processing...';
            
            if (output) {
                outputDiv.style.display = 'block';
                outputDiv.textContent = output;
            }
        }

        function addLogEntry(message) {
            const logContainer = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStats(passed, failed, total, duration) {
            document.getElementById('passed-tests').textContent = passed;
            document.getElementById('failed-tests').textContent = failed;
            document.getElementById('total-tests').textContent = total;
            document.getElementById('test-time').textContent = `${duration}s`;
        }

        function simulateTestExecution(testId, callback) {
            const test = testDefinitions.find(t => t.id === testId);
            if (!test) return;
            
            addLogEntry(`Starting ${test.name}...`);
            updateTestCard(testId, 'pending', null, null, 'Running...');
            
            // Simulate test execution time
            const executionTime = Math.random() * 3 + 1; // 1-4 seconds
            
            setTimeout(() => {
                // Simulate random success/failure for demo
                const success = Math.random() > 0.3; // 70% success rate
                const status = success ? 'success' : 'failed';
                const duration = `${executionTime.toFixed(2)}s`;
                const result = success ? 'PASSED' : 'FAILED';
                
                let output = '';
                if (success) {
                    output = generateSuccessOutput(test);
                } else {
                    output = generateFailureOutput(test);
                }
                
                updateTestCard(testId, status, duration, output, result);
                addLogEntry(`${test.name} completed: ${result} (${duration})`);
                
                testResults[testId] = { status, duration, result, output };
                
                if (callback) callback(status === 'success');
            }, executionTime * 1000);
        }

        function generateSuccessOutput(test) {
            const outputs = {
                'websocket_connection': '‚úÖ Successfully connected to qollective holodeck-environment WebSocket server\\nConnection status: 101 Switching Protocols\\nüîó WebSocket handshake completed',
                'health_check': '‚úÖ Health check successful: {"service":"holodeck-environment","status":"healthy","uptime_seconds":3600,"version":"0.1.0"}',
                'service_info': '‚úÖ Service info successful: {"service_name":"holodeck-environment","version":"0.1.0","llm_provider":"ollama","environment_capabilities":{"3d_environment_generation":true}}',
                'environment_generation': '‚úÖ 3D Environment generation successful!\\nüåç Environment type: starship\\nüõ°Ô∏è Safety level: standard\\n‚è±Ô∏è Generation time: 2847ms\\nü§ñ LLM provider: ollama',
                'scene_lighting': '‚úÖ Scene management (lighting) successful!\\nüé¨ Scene ID: enterprise-bridge-001\\nüîß Operation: update_lighting\\n‚ú® Modifications: 3',
                'scene_weather': '‚úÖ Weather change successful!\\nüåßÔ∏è Scene: alien-world-forest\\nüå¶Ô∏è Weather modifications: 2',
                'safety_validation': '‚úÖ Environmental safety validation successful!\\nüõ°Ô∏è Environment: starship-bridge-test\\nüìä Safety level: standard\\n‚úÖ Status: compliant\\nüîç Constraints checked: 8',
                'error_handling': '‚úÖ Invalid tool call correctly handled with error\\n‚ùå Error message: Tool nonexistent_tool not mapped. Available tools: [generate_environment, manage_scene, validate_environmental_safety, health_check, get_service_info]',
                'multiple_environments': '‚úÖ All environment types generated successfully!\\nüåç Alien environment generated\\nüèõÔ∏è Fantasy environment generated\\nüèõÔ∏è Historical environment generated\\nüåå Space environment generated'
            };
            return outputs[test.id] || '‚úÖ Test completed successfully';
        }

        function generateFailureOutput(test) {
            const outputs = {
                'websocket_connection': '‚ùå Failed to connect to qollective holodeck-environment server: Connection refused. Make sure the server is running with: cargo run -p holodeck-environment',
                'health_check': '‚ùå Health check request timed out',
                'service_info': '‚ùå Service info retrieval failed: Connection timeout',
                'environment_generation': '‚ùå Environment generation request timed out',
                'scene_lighting': '‚ùå Scene management failed: Scene not found',
                'scene_weather': '‚ùå Weather change request failed: Invalid scene ID',
                'safety_validation': '‚ùå Safety validation failed: Environment violates safety constraints',
                'error_handling': '‚ùå Error handling test failed: Unexpected response format',
                'multiple_environments': '‚ùå Multiple environment test failed: Timeout on alien environment generation'
            };
            return outputs[test.id] || '‚ùå Test failed with unknown error';
        }

        async function runTests() {
            if (currentTestRun) {
                addLogEntry('Test run already in progress');
                return;
            }
            
            currentTestRun = Date.now();
            document.getElementById('loading').classList.add('active');
            document.querySelector('.run-tests-btn').disabled = true;
            
            addLogEntry('üöÄ Starting full test suite execution');
            
            let passed = 0;
            let failed = 0;
            const total = testDefinitions.length;
            const startTime = Date.now();
            
            for (let i = 0; i < testDefinitions.length; i++) {
                const test = testDefinitions[i];
                
                await new Promise((resolve) => {
                    simulateTestExecution(test.id, (success) => {
                        if (success) passed++;
                        else failed++;
                        
                        updateStats(passed, failed, total, ((Date.now() - startTime) / 1000).toFixed(1));
                        resolve();
                    });
                });
                
                // Small delay between tests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            const totalTime = ((Date.now() - startTime) / 1000).toFixed(1);
            addLogEntry(`üèÅ Test suite completed: ${passed} passed, ${failed} failed (${totalTime}s total)`);
            
            document.getElementById('loading').classList.remove('active');
            document.querySelector('.run-tests-btn').disabled = false;
            currentTestRun = null;
        }

        async function runSingleTest(testId) {
            if (currentTestRun) {
                addLogEntry('Test run already in progress');
                return;
            }
            
            currentTestRun = Date.now();
            addLogEntry(`üéØ Running single test: ${testId}`);
            
            await new Promise((resolve) => {
                simulateTestExecution(testId, (success) => {
                    addLogEntry(`Single test completed: ${success ? 'PASSED' : 'FAILED'}`);
                    resolve();
                });
            });
            
            currentTestRun = null;
        }

        function clearResults() {
            testResults = {};
            initializeTestCards();
            updateStats(0, 0, testDefinitions.length, '0.0');
            
            const logContainer = document.getElementById('test-log');
            logContainer.innerHTML = `
                <div class="log-entry">
                    <span class="timestamp">[${new Date().toLocaleTimeString()}]</span> Test results cleared
                </div>
                <div class="log-entry">
                    <span class="timestamp">[${new Date().toLocaleTimeString()}]</span> Ready for new test execution
                </div>
            `;
            
            addLogEntry('üßπ All test results cleared');
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializeTestCards();
            addLogEntry('üåå Holodeck Environment Test Suite ready');
            addLogEntry('üí° Click "Run All Tests" to start comprehensive testing');
        });

        // Auto-refresh every 30 seconds if tests are running
        setInterval(() => {
            if (currentTestRun) {
                addLogEntry('‚è∞ Test execution in progress...');
            }
        }, 30000);
    </script>
</body>
</html>