{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "holodeck.json",
  "title": "Holodeck",
  "description": "Holodeck schemas for Rust code generation",
  "type": "object",
  "properties": {
    "holodeck": {
      "$ref": "#/definitions/Holodeck"
    },
    "character": {
      "$ref": "#/definitions/Character"
    },
    "story_template": {
      "$ref": "#/definitions/StoryTemplate"
    },
    "story_book": {
      "$ref": "#/definitions/StoryBook"
    }
  },
  "definitions": {
    "Holodeck": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100
        },
        "topic": {
          "type": "string",
          "minLength": 1,
          "maxLength": 500
        },
        "story_type": {
          "type": "string",
          "enum": ["Adventure", "Mystery", "Drama", "Comedy", "Historical", "SciFi", "Fantasy", "Educational"]
        },
        "participants": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Character"
          }
        },
        "current_scene": {
          "oneOf": [
            { "type": "null" },
            { "$ref": "#/definitions/Scene" }
          ]
        },
        "configuration": {
          "$ref": "#/definitions/HolodeckConfig"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["id", "name", "topic", "story_type", "participants", "configuration", "created_at", "updated_at"],
      "additionalProperties": false
    },

    "Character": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100
        },
        "character_type": {
          "type": "string",
          "enum": ["Captain", "FirstOfficer", "Android", "ChiefEngineer", "ChiefMedicalOfficer", "Counselor", "ChiefOfSecurity", "NavigationOfficer", "BarTender", "Civilian", "HistoricalFigure", "Custom"]
        },
        "personality": {
          "$ref": "#/definitions/PersonalityTraits"
        },
        "voice_config": {
          "$ref": "#/definitions/VoiceConfig"
        },
        "appearance": {
          "$ref": "#/definitions/CharacterAppearance"
        },
        "knowledge_domains": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["Starfleet", "Engineering", "Medical", "Psychology", "Physics", "Diplomacy", "MilitaryTactics", "Philosophy", "History", "AlienCultures", "Technology", "Navigation"]
          }
        },
        "relationships": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/CharacterRelationship"
          }
        },
        "current_mood": {
          "type": "string",
          "enum": ["Calm", "Excited", "Concerned", "Focused", "Curious", "Amused", "Serious", "Contemplative"]
        },
        "position": {
          "oneOf": [
            { "type": "null" },
            { "$ref": "#/definitions/Position3D" }
          ]
        },
        "status": {
          "type": "string",
          "enum": ["Active", "Inactive", "Busy", "AwayFromStation", "InMeeting", "EmergencyProtocol"]
        }
      },
      "required": ["id", "name", "character_type", "personality", "voice_config", "appearance", "knowledge_domains", "relationships", "current_mood", "status"],
      "additionalProperties": false
    },

    "PersonalityTraits": {
      "type": "object",
      "properties": {
        "logical": { "type": "number", "minimum": 0, "maximum": 1 },
        "emotional": { "type": "number", "minimum": 0, "maximum": 1 },
        "authoritative": { "type": "number", "minimum": 0, "maximum": 1 },
        "diplomatic": { "type": "number", "minimum": 0, "maximum": 1 },
        "curious": { "type": "number", "minimum": 0, "maximum": 1 },
        "cautious": { "type": "number", "minimum": 0, "maximum": 1 },
        "humor_tendency": { "type": "number", "minimum": 0, "maximum": 1 },
        "leadership_style": {
          "type": "string",
          "enum": ["Commanding", "Collaborative", "Technical", "Supportive", "Analytical"]
        },
        "communication_style": {
          "type": "string",
          "enum": ["Direct", "Diplomatic", "Technical", "Philosophical", "Empathetic", "Formal"]
        }
      },
      "required": ["logical", "emotional", "authoritative", "diplomatic", "curious", "cautious", "humor_tendency", "leadership_style", "communication_style"],
      "additionalProperties": false
    },

    "VoiceConfig": {
      "type": "object",
      "properties": {
        "voice_actor": { "type": "string", "minLength": 1, "maxLength": 100 },
        "speech_patterns": {
          "type": "array",
          "items": { "$ref": "#/definitions/SpeechPattern" }
        },
        "common_phrases": {
          "type": "array",
          "items": { "type": "string", "minLength": 1, "maxLength": 200 }
        },
        "accent": {
          "oneOf": [
            { "type": "null" },
            { "type": "string", "minLength": 1, "maxLength": 50 }
          ]
        },
        "tone_modulation": { "$ref": "#/definitions/ToneModulation" }
      },
      "required": ["voice_actor", "speech_patterns", "common_phrases", "tone_modulation"],
      "additionalProperties": false
    },

    "SpeechPattern": {
      "type": "object",
      "properties": {
        "pattern_type": {
          "type": "string",
          "enum": ["CatchPhrase", "TechnicalJargon", "PhilosophicalReference", "MilitaryProtocol", "ScientificExplanation", "EmotionalExpression", "LogicalAnalysis"]
        },
        "frequency": { "type": "number", "minimum": 0, "maximum": 1 },
        "examples": {
          "type": "array",
          "items": { "type": "string", "minLength": 1, "maxLength": 500 },
          "minItems": 1
        }
      },
      "required": ["pattern_type", "frequency", "examples"],
      "additionalProperties": false
    },

    "ToneModulation": {
      "type": "object",
      "properties": {
        "base_pitch": { "type": "number", "minimum": 0, "maximum": 1 },
        "emotional_range": { "type": "number", "minimum": 0, "maximum": 1 },
        "formality_level": { "type": "number", "minimum": 0, "maximum": 1 },
        "speech_speed": { "type": "number", "minimum": 0, "maximum": 1 }
      },
      "required": ["base_pitch", "emotional_range", "formality_level", "speech_speed"],
      "additionalProperties": false
    },

    "CharacterAppearance": {
      "type": "object",
      "properties": {
        "species": {
          "type": "string",
          "enum": ["Human", "Android", "Klingon", "Vulcan", "Betazoid", "ElAurian", "Bolian", "Custom"]
        },
        "custom_species": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Custom species name when species is 'Custom'"
        },
        "height_cm": { "type": "number", "minimum": 30, "maximum": 300 },
        "uniform_color": {
          "type": "string",
          "enum": ["Command", "Sciences", "Operations", "Civilian"]
        },
        "distinctive_features": {
          "type": "array",
          "items": { "type": "string", "minLength": 1, "maxLength": 100 }
        },
        "holographic_fidelity": {
          "type": "string",
          "enum": ["Basic", "Standard", "HighDefinition", "Photorealistic"]
        }
      },
      "required": ["species", "height_cm", "uniform_color", "distinctive_features", "holographic_fidelity"],
      "additionalProperties": false
    },

    "CharacterRelationship": {
      "type": "object",
      "properties": {
        "other_character_id": { "type": "string", "format": "uuid" },
        "relationship_type": {
          "type": "string",
          "enum": ["Superior", "Subordinate", "Colleague", "Friend", "Mentor", "Rival", "Family", "Romantic"]
        },
        "strength": { "type": "number", "minimum": 0, "maximum": 1 },
        "trust_level": { "type": "number", "minimum": 0, "maximum": 1 }
      },
      "required": ["other_character_id", "relationship_type", "strength", "trust_level"],
      "additionalProperties": false
    },

    "Position3D": {
      "type": "object",
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "z": { "type": "number" }
      },
      "required": ["x", "y", "z"],
      "additionalProperties": false
    },

    "Scene": {
      "type": "object",
      "properties": {
        "id": { "type": "string", "format": "uuid" },
        "name": { "type": "string", "minLength": 1, "maxLength": 100 },
        "description": { "type": "string", "minLength": 1, "maxLength": 1000 },
        "environment_id": { "type": "string", "format": "uuid" },
        "characters_present": {
          "type": "array",
          "items": { "type": "string", "format": "uuid" }
        },
        "props": {
          "type": "array",
          "items": { "$ref": "#/definitions/SceneProp" }
        },
        "background_audio": {
          "oneOf": [
            { "type": "null" },
            { "type": "string", "minLength": 1 }
          ]
        },
        "lighting_config": { "$ref": "#/definitions/LightingConfig" },
        "physics_settings": { "$ref": "#/definitions/PhysicsSettings" }
      },
      "required": ["id", "name", "description", "environment_id", "characters_present", "props", "lighting_config", "physics_settings"],
      "additionalProperties": false
    },

    "SceneProp": {
      "type": "object",
      "properties": {
        "id": { "type": "string", "format": "uuid" },
        "name": { "type": "string", "minLength": 1, "maxLength": 100 },
        "description": { "type": "string", "minLength": 1, "maxLength": 500 },
        "position": { "$ref": "#/definitions/Position3D" },
        "interactive": { "type": "boolean" },
        "physics_enabled": { "type": "boolean" }
      },
      "required": ["id", "name", "description", "position", "interactive", "physics_enabled"],
      "additionalProperties": false
    },

    "LightingConfig": {
      "type": "object",
      "properties": {
        "ambient_light": { "type": "number", "minimum": 0, "maximum": 1 },
        "directional_lights": {
          "type": "array",
          "items": { "$ref": "#/definitions/DirectionalLight" }
        },
        "mood": {
          "type": "string",
          "enum": ["Bright", "Dim", "Dramatic", "Cozy", "Mysterious", "Tense"]
        }
      },
      "required": ["ambient_light", "directional_lights", "mood"],
      "additionalProperties": false
    },

    "DirectionalLight": {
      "type": "object",
      "properties": {
        "direction": { "$ref": "#/definitions/Position3D" },
        "intensity": { "type": "number", "minimum": 0, "maximum": 1 },
        "color": { "$ref": "#/definitions/Color" }
      },
      "required": ["direction", "intensity", "color"],
      "additionalProperties": false
    },

    "Color": {
      "type": "object",
      "properties": {
        "r": { "type": "integer", "minimum": 0, "maximum": 255 },
        "g": { "type": "integer", "minimum": 0, "maximum": 255 },
        "b": { "type": "integer", "minimum": 0, "maximum": 255 },
        "a": { "type": "integer", "minimum": 0, "maximum": 255 }
      },
      "required": ["r", "g", "b", "a"],
      "additionalProperties": false
    },

    "PhysicsSettings": {
      "type": "object",
      "properties": {
        "gravity_enabled": { "type": "boolean" },
        "gravity_strength": { "type": "number", "minimum": 0 },
        "collision_detection": { "type": "boolean" },
        "real_time_physics": { "type": "boolean" }
      },
      "required": ["gravity_enabled", "gravity_strength", "collision_detection", "real_time_physics"],
      "additionalProperties": false
    },

    "HolodeckConfig": {
      "type": "object",
      "properties": {
        "safety_level": {
          "type": "string",
          "enum": ["Training", "Standard", "Reduced", "Disabled"]
        },
        "max_participants": { "type": "integer", "minimum": 1, "maximum": 20 },
        "duration_minutes": {
          "oneOf": [
            { "type": "null" },
            { "type": "integer", "minimum": 1, "maximum": 480 }
          ]
        },
        "auto_save_enabled": { "type": "boolean" },
        "voice_recognition": { "type": "boolean" },
        "haptic_feedback": { "type": "boolean" },
        "replicator_access": { "type": "boolean" },
        "transporter_integration": { "type": "boolean" },
        "environmental_controls": { "$ref": "#/definitions/EnvironmentalControls" },
        "llm_config": { "$ref": "#/definitions/LlmConfig" }
      },
      "required": ["safety_level", "max_participants", "auto_save_enabled", "voice_recognition", "haptic_feedback", "replicator_access", "transporter_integration", "environmental_controls", "llm_config"],
      "additionalProperties": false
    },

    "EnvironmentalControls": {
      "type": "object",
      "properties": {
        "temperature_celsius": { "type": "number", "minimum": -50, "maximum": 100 },
        "humidity_percent": { "type": "number", "minimum": 0, "maximum": 100 },
        "atmospheric_pressure": { "type": "number", "minimum": 0, "maximum": 200 },
        "oxygen_level": { "type": "number", "minimum": 0, "maximum": 100 },
        "wind_simulation": { "type": "boolean" },
        "weather_effects": { "type": "boolean" }
      },
      "required": ["temperature_celsius", "humidity_percent", "atmospheric_pressure", "oxygen_level", "wind_simulation", "weather_effects"],
      "additionalProperties": false
    },

    "LlmConfig": {
      "type": "object",
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["OpenAI", "Ollama", "Anthropic", "Perplexity"]
        },
        "model": { "type": "string", "minLength": 1 },
        "endpoint_url": {
          "oneOf": [
            { "type": "null" },
            { "type": "string", "format": "uri" }
          ]
        },
        "temperature": {
          "oneOf": [
            { "type": "null" },
            { "type": "number", "minimum": 0, "maximum": 1 }
          ]
        },
        "max_tokens": {
          "oneOf": [
            { "type": "null" },
            { "type": "integer", "minimum": 1 }
          ]
        },
        "timeout_seconds": {
          "oneOf": [
            { "type": "null" },
            { "type": "integer", "minimum": 1 }
          ]
        }
      },
      "required": ["provider", "model"],
      "additionalProperties": false
    },

    "StoryTemplate": {
      "type": "object",
      "properties": {
        "id": { "type": "string", "format": "uuid" },
        "name": { "type": "string", "minLength": 1, "maxLength": 200 },
        "topic": { "type": "string", "minLength": 1, "maxLength": 1000 },
        "genre": {
          "type": "string",
          "enum": ["Adventure", "Mystery", "Drama", "Comedy", "Historical", "SciFi", "Fantasy", "Educational", "Diplomatic", "Exploration"]
        },
        "scenes": {
          "type": "array",
          "items": { "$ref": "#/definitions/SceneTemplate" }
        },
        "story_graph": { "$ref": "#/definitions/StoryGraph" },
        "metadata": { "$ref": "#/definitions/StoryMetadata" },
        "estimated_duration_minutes": { "type": "integer", "minimum": 1, "maximum": 600 },
        "difficulty_level": {
          "type": "string",
          "enum": ["Beginner", "Intermediate", "Advanced", "Expert"]
        },
        "created_at": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "name", "topic", "genre", "scenes", "story_graph", "metadata", "estimated_duration_minutes", "difficulty_level", "created_at"],
      "additionalProperties": false
    },

    "StoryBook": {
      "type": "object",
      "properties": {
        "id": { "type": "string", "format": "uuid" },
        "template_id": { "type": "string", "format": "uuid" },
        "name": { "type": "string", "minLength": 1, "maxLength": 200 },
        "played_scenes": {
          "type": "array",
          "items": { "$ref": "#/definitions/PlayedScene" }
        },
        "current_position": { "$ref": "#/definitions/GraphNode" },
        "player_decisions": {
          "type": "array",
          "items": { "$ref": "#/definitions/PlayerDecision" }
        },
        "story_flags": {
          "type": "object",
          "patternProperties": {
            "^.+$": {
              "description": "Story flags with arbitrary JSON values"
            }
          }
        },
        "character_states": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/CharacterState"
          }
        },
        "session_metrics": { "$ref": "#/definitions/SessionMetrics" },
        "created_at": { "type": "string", "format": "date-time" },
        "last_saved": { "type": "string", "format": "date-time" },
        "status": {
          "type": "string",
          "enum": ["InProgress", "Completed", "Paused", "Abandoned", "Archived"]
        }
      },
      "required": ["id", "template_id", "name", "played_scenes", "current_position", "player_decisions", "story_flags", "character_states", "session_metrics", "created_at", "last_saved", "status"],
      "additionalProperties": false
    },

    "SceneTemplate": {
      "type": "object",
      "properties": {
        "id": { "type": "string", "format": "uuid" },
        "name": { "type": "string", "minLength": 1, "maxLength": 200 },
        "description": { "type": "string", "minLength": 1, "maxLength": 2000 },
        "environment_type": { "type": "string" },
        "required_characters": {
          "type": "array",
          "items": { "type": "string" }
        },
        "optional_characters": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "required": ["id", "name", "description", "environment_type", "required_characters", "optional_characters"],
      "additionalProperties": false
    },

    "StoryGraph": {
      "type": "object",
      "properties": {
        "nodes": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/GraphNode"
          }
        },
        "root_node_id": { "type": "string", "format": "uuid" },
        "ending_node_ids": {
          "type": "array",
          "items": { "type": "string", "format": "uuid" },
          "minItems": 1
        }
      },
      "required": ["nodes", "root_node_id", "ending_node_ids"],
      "additionalProperties": false
    },

    "GraphNode": {
      "type": "object",
      "properties": {
        "id": { "type": "string", "format": "uuid" },
        "scene_id": { "type": "string", "format": "uuid" },
        "connections": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "target_node_id": { "type": "string", "format": "uuid" },
              "condition": { "type": "string" },
              "description": { "type": "string", "minLength": 1, "maxLength": 500 }
            },
            "required": ["target_node_id", "condition", "description"],
            "additionalProperties": false
          }
        },
        "is_checkpoint": { "type": "boolean" }
      },
      "required": ["id", "scene_id", "connections", "is_checkpoint"],
      "additionalProperties": false
    },

    "StoryMetadata": {
      "type": "object",
      "properties": {
        "author": { "type": "string", "minLength": 1, "maxLength": 200 },
        "version": { "type": "string", "minLength": 1, "maxLength": 50 },
        "tags": {
          "type": "array",
          "items": { "type": "string", "minLength": 1, "maxLength": 100 }
        },
        "target_audience": {
          "type": "string",
          "enum": ["Children", "Teens", "Adults", "Families", "StarfleetCadets", "General"]
        },
        "content_rating": {
          "type": "string",
          "enum": ["Everyone", "Teen", "Mature", "Educational"]
        }
      },
      "required": ["author", "version", "tags", "target_audience", "content_rating"],
      "additionalProperties": false
    },

    "PlayedScene": {
      "type": "object",
      "properties": {
        "scene_id": { "type": "string", "format": "uuid" },
        "started_at": { "type": "string", "format": "date-time" },
        "completed_at": {
          "oneOf": [
            { "type": "null" },
            { "type": "string", "format": "date-time" }
          ]
        },
        "player_actions": {
          "type": "array",
          "items": { "type": "string" }
        },
        "outcome": { "type": "string" }
      },
      "required": ["scene_id", "started_at", "player_actions", "outcome"],
      "additionalProperties": false
    },

    "PlayerDecision": {
      "type": "object",
      "properties": {
        "decision_id": { "type": "string", "format": "uuid" },
        "scene_id": { "type": "string", "format": "uuid" },
        "decision_text": { "type": "string", "minLength": 1 },
        "chosen_option": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "consequences": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "required": ["decision_id", "scene_id", "decision_text", "chosen_option", "timestamp", "consequences"],
      "additionalProperties": false
    },

    "CharacterState": {
      "type": "object",
      "properties": {
        "character_id": { "type": "string", "format": "uuid" },
        "current_mood": {
          "type": "string",
          "enum": ["Calm", "Excited", "Concerned", "Focused", "Curious", "Amused", "Serious", "Contemplative"]
        },
        "trust_levels": {
          "type": "array",
          "items": {
            "type": "object", 
            "properties": {
              "character_id": { "type": "string", "format": "uuid" },
              "trust_level": { "type": "number", "minimum": 0, "maximum": 1 }
            },
            "required": ["character_id", "trust_level"],
            "additionalProperties": false
          }
        },
        "story_flags": {
          "type": "object",
          "additionalProperties": true
        },
        "position": {
          "oneOf": [
            { "type": "null" },
            { "$ref": "#/definitions/Position3D" }
          ]
        }
      },
      "required": ["character_id", "current_mood", "trust_levels", "story_flags"],
      "additionalProperties": false
    },

    "SessionMetrics": {
      "type": "object",
      "properties": {
        "total_play_time_minutes": { "type": "number", "minimum": 0 },
        "scenes_completed": { "type": "integer", "minimum": 0 },
        "decisions_made": { "type": "integer", "minimum": 0 },
        "characters_interacted_with": { "type": "integer", "minimum": 0 },
        "story_completion_percentage": { "type": "number", "minimum": 0, "maximum": 100 },
        "engagement_score": { "type": "number", "minimum": 0, "maximum": 10 }
      },
      "required": ["total_play_time_minutes", "scenes_completed", "decisions_made", "characters_interacted_with", "story_completion_percentage", "engagement_score"],
      "additionalProperties": false
    }
  }
}
