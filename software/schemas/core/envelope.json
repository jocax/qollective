{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.qollective.io/core/envelope.json",
  "title": "Qollective Envelope Schema",
  "description": "Comprehensive envelope structure for Qollective Framework supporting cross-language, cross-protocol payload data harmonization with configurable meta sections",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "meta": {
      "type": "object",
      "description": "Response meta with core properties and optional configurable sections",
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when the response was generated",
          "examples": ["2024-06-06T14:23:15.456Z", "2024-12-25T09:30:00.000Z"]
        },
        "requestId": {
          "type": "string",
          "format": "uuid",
          "description": "Unique request identifier for tracing and correlation across service boundaries",
          "examples": ["550e8400-e29b-41d4-a716-446655440000", "6ba7b810-9dad-11d1-80b4-00c04fd430c8"]
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "API version in semantic versioning format",
          "examples": ["1.0.0", "2.1.3", "0.5.0"]
        },
        "duration": {
          "type": "number",
          "minimum": 0,
          "multipleOf": 0.001,
          "description": "Request processing duration in milliseconds with microsecond precision",
          "examples": [245.7, 12.345, 1523.001]
        },
        "tenant": {
          "type": "string",
          "description": "Multi-tenant identifier for the original user's tenant context (tenant isolation and context propagation)",
          "pattern": "^[a-z0-9][a-z0-9-]*[a-z0-9]$",
          "minLength": 1,
          "maxLength": 100,
          "examples": ["tenant-123", "acme-corp", "org-456"]
        },
        "onBehalfOf": {
          "type": "object",
          "description": "Delegation context when one user or service acts on behalf of another, potentially across tenant boundaries",
          "properties": {
            "originalUser": {
              "type": "string",
              "description": "The original user or entity being acted upon (belongs to the tenant specified in meta.tenant)",
              "minLength": 1,
              "maxLength": 255,
              "examples": ["user_12345", "admin@example.com", "service-account-billing"]
            },
            "delegatingUser": {
              "type": "string",
              "description": "The user or service performing the action on behalf of the original user",
              "minLength": 1,
              "maxLength": 255,
              "examples": ["admin_67890", "support@example.com", "service-account-api", "delegate-user-456"]
            },
            "delegatingTenant": {
              "type": "string",
              "description": "The tenant context of the delegating user (may differ from the original user's tenant in meta.tenant)",
              "pattern": "^[a-z0-9][a-z0-9-]*[a-z0-9]$",
              "minLength": 1,
              "maxLength": 100,
              "examples": ["admin-tenant", "support-org", "service-tenant"]
            }
          },
          "required": ["originalUser", "delegatingUser", "delegatingTenant"],
          "additionalProperties": false,
          "examples": [
            {
              "originalUser": "user_12345",
              "delegatingUser": "admin_67890",
              "delegatingTenant": "admin-tenant"
            },
            {
              "originalUser": "customer@acme-corp.com",
              "delegatingUser": "support@platform.com",
              "delegatingTenant": "platform-support"
            }
          ]
        },
        "serviceChain": {
          "type": "array",
          "description": "Chain of services that processed this request, enabling nested envelope tracking",
          "items": {
            "type": "object",
            "properties": {
              "serviceName": {
                "type": "string",
                "description": "Name of the service in the chain",
                "pattern": "^[a-z][a-z0-9-]*[a-z0-9]$",
                "examples": ["user-service", "payment-service", "notification-service"]
              },
              "serviceVersion": {
                "type": "string",
                "pattern": "^\\d+\\.\\d+\\.\\d+$",
                "description": "Version of the service",
                "examples": ["1.2.0", "3.1.4"]
              },
              "requestId": {
                "type": "string",
                "format": "uuid",
                "description": "Request ID generated by this service"
              },
              "timestamp": {
                "type": "string",
                "format": "date-time",
                "description": "When this service processed the request"
              },
              "duration": {
                "type": "number",
                "minimum": 0,
                "description": "Processing time for this service in milliseconds"
              }
            },
            "required": ["serviceName", "serviceVersion", "requestId", "timestamp"],
            "additionalProperties": false
          },
          "maxItems": 50,
          "uniqueItems": false
        },
        "security": {
          "type": "object",
          "description": "Security context and user information (optional, config-driven)",
          "properties": {
            "user_id": {
              "type": "string",
              "description": "Current authenticated user identifier",
              "minLength": 1,
              "maxLength": 255,
              "examples": ["user_12345", "auth0|507f1f77bcf86cd799439011", "admin@example.com"]
            },
            "session_id": {
              "type": "string",
              "description": "User session identifier for this authentication session",
              "minLength": 1,
              "maxLength": 255,
              "examples": ["sess_1NXWnCWxLdhI2RMIxaXYL7vtS3c", "session-abc123def456"]
            },
            "auth_method": {
              "type": "string",
              "enum": ["oauth2", "jwt", "api_key", "basic", "saml", "oidc", "none"],
              "description": "Authentication method used for this request",
              "examples": ["oauth2", "jwt", "api_key"]
            },
            "permissions": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9_]*:[a-z][a-z0-9_]*$"
              },
              "description": "User permissions for this request in format 'resource:action'",
              "uniqueItems": true,
              "maxItems": 100,
              "examples": [["user:read", "user:write", "admin:manage"], ["product:read"]]
            },
            "ip_address": {
              "oneOf": [
                {
                  "type": "string",
                  "format": "ipv4",
                  "description": "IPv4 address"
                },
                {
                  "type": "string",
                  "format": "ipv6",
                  "description": "IPv6 address"
                }
              ],
              "description": "Client IP address (IPv4 or IPv6)",
              "examples": ["192.168.1.100", "10.0.0.1", "2001:db8::1"]
            },
            "user_agent": {
              "type": "string",
              "description": "Client user agent string",
              "maxLength": 1000,
              "examples": ["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36", "PostmanRuntime/7.28.4"]
            },
            "tenant_id": {
              "type": "string",
              "description": "Multi-tenant identifier for tenant isolation",
              "pattern": "^[a-z0-9][a-z0-9-]*[a-z0-9]$",
              "minLength": 1,
              "maxLength": 100,
              "examples": ["tenant-123", "acme-corp", "org-456"]
            },
            "roles": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9_]*$"
              },
              "description": "User roles assigned for this session",
              "uniqueItems": true,
              "maxItems": 50,
              "examples": [["admin", "user"], ["read_only", "billing_admin"]]
            },
            "token_expires_at": {
              "type": "string",
              "format": "date-time",
              "description": "When the authentication token expires",
              "examples": ["2024-06-07T14:23:15.456Z"]
            }
          },
          "additionalProperties": false
        },
        "debug": {
          "type": "object",
          "description": "Debug information (optional, typically development only - never include in production)",
          "properties": {
            "trace_enabled": {
              "type": "boolean",
              "description": "Whether detailed tracing was enabled for this request",
              "examples": [true, false]
            },
            "sql_queries": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "query": {
                    "type": "string",
                    "description": "SQL query statement (sanitized of sensitive data)",
                    "minLength": 1,
                    "maxLength": 10000
                  },
                  "duration": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Query execution time in milliseconds"
                  },
                  "rows_affected": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Number of rows affected by the query"
                  },
                  "database": {
                    "type": "string",
                    "description": "Database name or identifier",
                    "maxLength": 100
                  }
                },
                "required": ["query", "duration"],
                "additionalProperties": false
              },
              "description": "SQL queries executed during request processing",
              "maxItems": 100
            },
            "memory_usage": {
              "type": "object",
              "description": "Memory usage metrics during request processing",
              "properties": {
                "heap_used": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Heap memory used in bytes"
                },
                "heap_total": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Total heap memory in bytes"
                },
                "external": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "External memory usage in bytes"
                }
              },
              "additionalProperties": false
            },
            "stack_trace": {
              "type": "string",
              "description": "Stack trace information for debugging (errors only)",
              "maxLength": 50000
            },
            "environment_vars": {
              "type": "object",
              "additionalProperties": {
                "type": "string",
                "maxLength": 1000
              },
              "description": "Relevant environment variables (never include secrets)",
              "maxProperties": 20
            },
            "request_headers": {
              "type": "object",
              "additionalProperties": {
                "type": "string",
                "maxLength": 1000
              },
              "description": "HTTP request headers for debugging (sanitized of auth tokens)",
              "maxProperties": 50
            },
            "log_level": {
              "type": "string",
              "enum": ["trace", "debug", "info", "warn", "error"],
              "description": "Log level used for this request",
              "examples": ["debug", "info"]
            },
            "profiling_data": {
              "type": "object",
              "description": "Performance profiling data for this request",
              "properties": {
                "cpu_time": {
                  "type": "number",
                  "minimum": 0,
                  "description": "CPU time used in milliseconds"
                },
                "wall_time": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Wall clock time in milliseconds"
                },
                "allocations": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Number of memory allocations"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "performance": {
          "type": "object",
          "description": "Performance metrics for monitoring and optimization (optional, config-driven)",
          "properties": {
            "db_query_time": {
              "type": "number",
              "minimum": 0,
              "multipleOf": 0.001,
              "description": "Total database query time in milliseconds",
              "examples": [45.123, 156.7, 0.025]
            },
            "db_query_count": {
              "type": "integer",
              "minimum": 0,
              "description": "Total number of database queries executed",
              "examples": [3, 15, 0]
            },
            "cache_hit_ratio": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Cache hit ratio (0.0 to 1.0)",
              "examples": [0.85, 0.23, 1.0]
            },
            "cache_operations": {
              "type": "object",
              "description": "Cache operation statistics",
              "properties": {
                "hits": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Number of cache hits"
                },
                "misses": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Number of cache misses"
                },
                "sets": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Number of cache sets"
                }
              },
              "additionalProperties": false
            },
            "memory_allocated": {
              "type": "integer",
              "minimum": 0,
              "description": "Memory allocated in bytes for this request",
              "examples": [1048576, 524288, 2097152]
            },
            "memory_peak": {
              "type": "integer",
              "minimum": 0,
              "description": "Peak memory usage in bytes during request processing"
            },
            "cpu_usage": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "CPU usage percentage (0.0 to 1.0) during request processing",
              "examples": [0.15, 0.75, 0.02]
            },
            "network_latency": {
              "type": "number",
              "minimum": 0,
              "description": "Network latency in milliseconds for external calls",
              "examples": [12.5, 89.3, 245.1]
            },
            "external_calls": {
              "type": "array",
              "description": "Performance data for external service calls",
              "items": {
                "type": "object",
                "properties": {
                  "service": {
                    "type": "string",
                    "description": "External service name",
                    "maxLength": 100
                  },
                  "endpoint": {
                    "type": "string",
                    "description": "Endpoint called",
                    "maxLength": 500
                  },
                  "duration": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Call duration in milliseconds"
                  },
                  "status": {
                    "type": "string",
                    "enum": ["success", "error", "timeout"],
                    "description": "Call result status"
                  }
                },
                "required": ["service", "duration", "status"],
                "additionalProperties": false
              },
              "maxItems": 50
            },
            "gc_collections": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of garbage collection cycles during request",
              "examples": [0, 2, 5]
            },
            "gc_time": {
              "type": "number",
              "minimum": 0,
              "description": "Time spent in garbage collection in milliseconds"
            },
            "thread_count": {
              "type": "integer",
              "minimum": 1,
              "description": "Number of threads used for request processing"
            }
          },
          "additionalProperties": false
        },
        "monitoring": {
          "type": "object",
          "description": "Infrastructure and operational monitoring information (optional, config-driven)",
          "properties": {
            "server_id": {
              "type": "string",
              "description": "Server instance identifier for tracking requests across instances",
              "pattern": "^[a-zA-Z0-9][a-zA-Z0-9-._]*[a-zA-Z0-9]$",
              "maxLength": 100,
              "examples": ["web-server-01", "api-pod-5f8d4c7b9-xk2m7", "instance-i-1234567890abcdef0"]
            },
            "datacenter": {
              "type": "string",
              "description": "Datacenter, region, or availability zone identifier",
              "pattern": "^[a-z][a-z0-9-]*[a-z0-9]$",
              "maxLength": 50,
              "examples": ["us-west-2", "eu-central-1a", "datacenter-ny"]
            },
            "build_version": {
              "type": "string",
              "description": "Application build version or commit hash",
              "maxLength": 100,
              "examples": ["v1.2.3-build.456", "commit-abc123def456", "release-2024.06.01"]
            },
            "deployment_id": {
              "type": "string",
              "description": "Deployment identifier for tracking releases",
              "maxLength": 100,
              "examples": ["deploy-20240606-143000", "blue-green-v123", "canary-release-456"]
            },
            "instance_type": {
              "type": "string",
              "description": "Server instance type or configuration",
              "maxLength": 50,
              "examples": ["t3.medium", "c5.xlarge", "standard-4", "micro"]
            },
            "load_balancer": {
              "type": "string",
              "description": "Load balancer identifier that routed this request",
              "maxLength": 100,
              "examples": ["alb-web-tier", "nginx-lb-01", "cloudflare-proxy"]
            },
            "environment": {
              "type": "string",
              "enum": ["development", "staging", "testing", "production", "canary"],
              "description": "Environment where the service is running",
              "examples": ["production", "staging"]
            },
            "cluster_id": {
              "type": "string",
              "description": "Cluster or orchestration platform identifier",
              "maxLength": 100,
              "examples": ["k8s-prod-cluster", "ecs-cluster-web", "swarm-production"]
            },
            "namespace": {
              "type": "string",
              "description": "Kubernetes namespace or logical grouping",
              "pattern": "^[a-z0-9][a-z0-9-]*[a-z0-9]$",
              "maxLength": 63,
              "examples": ["default", "web-services", "payment-system"]
            },
            "health_status": {
              "type": "string",
              "enum": ["healthy", "degraded", "unhealthy"],
              "description": "Current health status of the service instance",
              "examples": ["healthy", "degraded"]
            },
            "uptime": {
              "type": "number",
              "minimum": 0,
              "description": "Service uptime in seconds",
              "examples": [86400, 259200, 3600]
            }
          },
          "additionalProperties": false
        },
        "tracing": {
          "type": "object",
          "description": "Distributed tracing information following OpenTelemetry standards (optional, config-driven)",
          "properties": {
            "trace_id": {
              "type": "string",
              "pattern": "^[a-f0-9]{32}$|^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$",
              "description": "Distributed trace identifier (128-bit hex or UUID format)",
              "examples": ["550e8400e29b41d4a716446655440000", "550e8400-e29b-41d4-a716-446655440000"]
            },
            "span_id": {
              "type": "string",
              "pattern": "^[a-f0-9]{16}$",
              "description": "Current span identifier (64-bit hex)",
              "examples": ["b7ad6b7169203331", "00f067aa0ba902b7"]
            },
            "parent_span_id": {
              "type": "string",
              "pattern": "^[a-f0-9]{16}$",
              "description": "Parent span identifier (64-bit hex)",
              "examples": ["00f067aa0ba902b7", "b7ad6b7169203331"]
            },
            "baggage": {
              "type": "object",
              "additionalProperties": {
                "type": "string",
                "maxLength": 1000
              },
              "description": "Tracing baggage key-value pairs for cross-service context",
              "maxProperties": 20,
              "examples": [{"user-type": "premium", "correlation-id": "abc123"}]
            },
            "sampling_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Trace sampling rate (0.0 to 1.0)",
              "examples": [1.0, 0.1, 0.01]
            },
            "sampled": {
              "type": "boolean",
              "description": "Whether this trace is being sampled",
              "examples": [true, false]
            },
            "trace_state": {
              "type": "string",
              "description": "W3C trace state header value for vendor-specific tracing data",
              "maxLength": 512,
              "examples": ["vendor1=value1,vendor2=value2"]
            },
            "operation_name": {
              "type": "string",
              "description": "Name of the operation being traced",
              "maxLength": 200,
              "examples": ["GET /api/users", "user.create", "database.query"]
            },
            "span_kind": {
              "type": "string",
              "enum": ["server", "client", "producer", "consumer", "internal"],
              "description": "OpenTelemetry span kind",
              "examples": ["server", "client"]
            },
            "span_status": {
              "type": "object",
              "description": "Span status information",
              "properties": {
                "code": {
                  "type": "string",
                  "enum": ["ok", "error", "timeout"],
                  "description": "Span status code"
                },
                "message": {
                  "type": "string",
                  "description": "Optional status message",
                  "maxLength": 500
                }
              },
              "required": ["code"],
              "additionalProperties": false
            },
            "tags": {
              "type": "object",
              "description": "Span tags/attributes for detailed tracing",
              "additionalProperties": {
                "oneOf": [
                  {"type": "string", "maxLength": 1000},
                  {"type": "number"},
                  {"type": "boolean"}
                ]
              },
              "maxProperties": 50
            }
          },
          "additionalProperties": false
        },
        "extensions": {
          "type": "object",
          "description": "Custom meta extensions for service-specific data. Keys should be service names or standardized extensions.",
          "properties": {
            "pagination": {
              "type": "object",
              "description": "Optional standardized pagination metadata for list responses",
              "properties": {
                "total_items": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Total number of items across all pages",
                  "examples": [1247, 0, 50]
                },
                "current_page": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Current page number (1-based)",
                  "examples": [1, 2, 15]
                },
                "total_pages": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Total number of pages available",
                  "examples": [125, 0, 3]
                },
                "page_size": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1000,
                  "description": "Number of items per page",
                  "examples": [10, 25, 100]
                },
                "has_next_page": {
                  "type": "boolean",
                  "description": "Whether there is a next page available",
                  "examples": [true, false]
                },
                "has_previous_page": {
                  "type": "boolean",
                  "description": "Whether there is a previous page available",
                  "examples": [true, false]
                },
                "items_on_page": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Number of items on the current page (may be less than page_size on last page)",
                  "examples": [10, 7, 0]
                },
                "cursor": {
                  "type": "string",
                  "description": "Cursor for cursor-based pagination (alternative to page-based)",
                  "maxLength": 500,
                  "examples": ["eyJpZCI6MTIzLCJjcmVhdGVkX2F0IjoiMjAyNC0wNi0wNiJ9", "next_cursor_token_here"]
                },
                "next_cursor": {
                  "type": "string",
                  "description": "Cursor for the next page in cursor-based pagination",
                  "maxLength": 500,
                  "examples": ["eyJpZCI6MTI0LCJjcmVhdGVkX2F0IjoiMjAyNC0wNi0wNyJ9"]
                },
                "previous_cursor": {
                  "type": "string",
                  "description": "Cursor for the previous page in cursor-based pagination",
                  "maxLength": 500,
                  "examples": ["eyJpZCI6MTIyLCJjcmVhdGVkX2F0IjoiMjAyNC0wNi0wNSJ9"]
                }
              },
              "additionalProperties": false,
              "examples": [
                {
                  "total_items": 1247,
                  "current_page": 2,
                  "total_pages": 125,
                  "page_size": 10,
                  "has_next_page": true,
                  "has_previous_page": true,
                  "items_on_page": 10
                },
                {
                  "total_items": 150,
                  "cursor": "eyJpZCI6MTIzLCJjcmVhdGVkX2F0IjoiMjAyNC0wNi0wNiJ9",
                  "next_cursor": "eyJpZCI6MTI0LCJjcmVhdGVkX2F0IjoiMjAyNC0wNi0wNyJ9",
                  "page_size": 25,
                  "items_on_page": 25
                }
              ]
            }
          },
          "additionalProperties": {
            "type": "object",
            "description": "Service-specific meta structure defined by the service schema",
            "additionalProperties": true
          },
          "propertyNames": {
            "pattern": "^[a-z][a-z0-9_]*[a-z0-9]$|^pagination$|^protocol$",
            "description": "Extension keys must be valid service names (lowercase, alphanumeric, underscores) or standardized extensions like 'pagination' and 'protocol'"
          },
          "maxProperties": 20,
          "examples": [
            {
              "pagination": {
                "total_items": 1247,
                "current_page": 2,
                "total_pages": 125,
                "page_size": 10,
                "has_next_page": true,
                "has_previous_page": true,
                "items_on_page": 10
              },
              "payment_service": {
                "transaction_id": "txn_123456",
                "payment_method": "credit_card",
                "amount": 99.99
              },
              "user_service": {
                "account_tier": "premium",
                "feature_flags": ["new_ui", "advanced_search"]
              }
            }
          ]
        }
      },
      "required": ["timestamp", "requestId", "version"],
      "additionalProperties": false
    },
    "payload": {
      "description": "The actual response payload when operation is successful. Can be any valid JSON value.",
      "examples": [
        {"user_id": 123, "name": "John Doe", "email": "john@example.com"},
        [{"id": 1, "title": "Product 1"}, {"id": 2, "title": "Product 2"}],
        "Simple string response",
        42,
        true,
        null
      ]
    },
    "error": {
      "type": "object",
      "description": "Error information when operation fails, following RFC 7807 Problem Details",
      "properties": {
        "code": {
          "type": "string",
          "description": "Machine-readable error code for programmatic handling",
          "pattern": "^[A-Z][A-Z0-9_]*$",
          "maxLength": 100,
          "examples": ["VALIDATION_ERROR", "USER_NOT_FOUND", "INSUFFICIENT_PERMISSIONS", "INTERNAL_SERVER_ERROR"]
        },
        "message": {
          "type": "string",
          "description": "Human-readable error message suitable for display to users",
          "minLength": 1,
          "maxLength": 1000,
          "examples": ["The requested user was not found", "Validation failed for field 'email'", "Internal server error occurred"]
        },
        "details": {
          "type": "object",
          "description": "Additional structured error details for debugging and context",
          "additionalProperties": true,
          "examples": [
            {"field": "email", "issue": "invalid_format", "expected": "valid email address"},
            {"resource_id": "user_123", "operation": "delete", "constraint": "has_active_orders"}
          ]
        },
        "trace": {
          "type": "string",
          "description": "Error trace identifier for debugging and log correlation",
          "format": "uuid",
          "examples": ["550e8400-e29b-41d4-a716-446655440000"]
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When the error occurred",
          "examples": ["2024-06-06T14:23:15.456Z"]
        },
        "path": {
          "type": "string",
          "description": "Request path where the error occurred",
          "maxLength": 1000,
          "examples": ["/api/v1/users/123", "/graphql", "/health"]
        },
        "method": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS"],
          "description": "HTTP method used when error occurred"
        },
        "status": {
          "type": "integer",
          "minimum": 400,
          "maximum": 599,
          "description": "HTTP status code associated with this error",
          "examples": [400, 401, 403, 404, 422, 500]
        },
        "retry_after": {
          "type": "integer",
          "minimum": 0,
          "description": "Suggested retry delay in seconds for retryable errors",
          "examples": [30, 60, 300]
        }
      },
      "required": ["code", "message"],
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "anyOf": [
    {
      "required": ["payload"],
      "description": "Success response with payload data"
    },
    {
      "required": ["error"],
      "description": "Error response with error details"
    }
  ],
  "not": {
    "allOf": [
      { "required": ["payload"] },
      { "required": ["error"] }
    ]
  },
  "examples": [
    {
      "meta": {
        "timestamp": "2024-06-06T14:23:15.456Z",
        "requestId": "550e8400-e29b-41d4-a716-446655440000",
        "version": "1.2.3",
        "duration": 245.7,
        "serviceChain": [
          {
            "serviceName": "api-gateway",
            "serviceVersion": "2.1.0",
            "requestId": "550e8400-e29b-41d4-a716-446655440001",
            "timestamp": "2024-06-06T14:23:14.000Z",
            "duration": 12.3
          },
          {
            "serviceName": "user-service",
            "serviceVersion": "1.5.2",
            "requestId": "550e8400-e29b-41d4-a716-446655440002",
            "timestamp": "2024-06-06T14:23:14.100Z",
            "duration": 233.4
          }
        ],
        "tenant": "acme-corp",
        "onBehalfOf": {
          "originalUser": "user_12345",
          "delegatingUser": "admin_67890",
          "delegatingTenant": "admin-tenant"
        },
        "security": {
          "user_id": "user_12345",
          "session_id": "sess_1NXWnCWxLdhI2RMIxaXYL7vtS3c",
          "auth_method": "jwt",
          "permissions": ["user:read", "user:write"],
          "tenant_id": "acme-corp"
        },
        "performance": {
          "db_query_time": 45.123,
          "db_query_count": 3,
          "cache_hit_ratio": 0.85,
          "memory_allocated": 1048576,
          "cpu_usage": 0.15
        },
        "monitoring": {
          "server_id": "web-server-01",
          "datacenter": "us-west-2",
          "environment": "production",
          "build_version": "v1.2.3-build.456"
        },
        "tracing": {
          "trace_id": "550e8400e29b41d4a716446655440000",
          "span_id": "b7ad6b7169203331",
          "operation_name": "GET /api/users/12345",
          "span_kind": "server",
          "sampled": true
        },
        "extensions": {
          "user_service": {
            "account_tier": "premium",
            "feature_flags": ["new_ui", "advanced_search"]
          }
        }
      },
      "payload": {
        "user_id": 12345,
        "name": "John Doe",
        "email": "john.doe@example.com",
        "created_at": "2024-01-15T10:30:00Z"
      }
    },
    {
      "meta": {
        "timestamp": "2024-06-06T14:25:30.789Z",
        "requestId": "6ba7b810-9dad-11d1-80b4-00c04fd430c8",
        "version": "1.2.3",
        "duration": 12.5
      },
      "error": {
        "code": "USER_NOT_FOUND",
        "message": "The requested user was not found",
        "details": {
          "user_id": "99999",
          "searched_in": ["primary_db", "cache"]
        },
        "trace": "6ba7b810-9dad-11d1-80b4-00c04fd430c8",
        "status": 404,
        "path": "/api/v1/users/99999",
        "method": "GET"
      }
    }
  ]
}
